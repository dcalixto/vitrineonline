<% title "Favoritos" %>
<%= render "shared/favorites_menu" %>

<div class="box3">
  <div class="block margin_top">
    <h1>Produtos Favoritos</h1>
    <div class="content">

      <h4>Total
        <%= current_user.favorite_products.count %>
        Produtos favoritados</h4>

        <div class="header"></div>
      <table class="block_search">
        <tr>
          <td>

            <%= search_form_for @q, url:  search_favorites_favorites_path, method: :post  do |f| %>

            <%= f.text_field :id_cont %>
            <%= f.submit "Buscar", :class=>"btn_grey" %>

            <% end %>
          </td>
          <td class="sort">

            Ordernar Por
            <%= sort_link @q, :price,  "Preço" %>
            |
            <%= sort_link @q, :created_at, "Data" %>
            |
            <%= sort_link @q, :quantity, "Quantidade" %>

          </td>
        </tr>
      </table>

      <div class="subcontent_top">

        <% @favorite_products.each do |p| %>
        <div class="product_row">

          <div class="product_img">
            <%= link_to  product_path(p.id) do %>
            <%= image_tag p.f1.url(:small).to_s %>

            <% end %>
          </div>

          <div class="product_link">

            <%= link_to  product_path(p.id)  do %>
            <%= p.name %>
            <% end%>

            <% if p.feedbacks %>
            <div class="feedback_stars_rating" data-read-only="true" data-score="<%= @average_rating_from_buyers %>"></div>

            <%= @total_feedbacks %>
            <% end %>

            <% if current_user %>
            <%if p.buyable?(current_user) %>

            <div class="add_to_car">

              <%= button_to("Adicionar a sacola",add_to_carts_path(p), :class => 'btn btn_big', :'data-submit-form' => true) do %>

              <%= content_tag(:i, nil, :class=>"add_to_cart_icon")  %>
              <%end %>

            </div>

            <%end %>

            <%end %>

          </div>
          <div class="product_price">

            <b ><%=  number_to_currency(p.price, :unit => "R$") %></b>

          </div>
          <div class="product_qty">
            <%= select_tag  :quantity, options_for_select((1..p.quantity).collect{ |q| [q, q]}) %>
          </div>

          <div class="product_time">

            <span class="lista-time">
              <%= timeago_tag(p.created_at, :nojs => true, :date_only => false)%></span>

          </div>


<div class="product_unmark">
    <%= button_to "Desfavoritar", unmark_favorite_path(p.id), method: :get, :class=>"btn_red btn_small" %>
  </div>
        </div>

        <% end %>
      </div>
    </div>


        <div class="block_pagination">
          <hr class="line"></hr>
          <div class="digg_pagination">
            <%= will_paginate @favorite_products,:container => false, previous_label: h('« Voltar'), next_label: h('Próximo »'),:page_gap => t("......"), :inner_window => 1, :outer_window => 1 %>

          </div>
        </div>
  </div>
</div>
